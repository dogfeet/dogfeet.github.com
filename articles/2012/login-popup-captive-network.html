<!DOCTYPE html>
<html lang="en">
  <head>
<!--Meta-->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>#dogfeet - Login Popup & Captive Network</title>
    <meta name="description" content="스마트폰이나 노트북을 항상 들고다니는 사람이 늘어남에 따라 모바일AP(즉, 핫스팟)을 이용하는 사람도 많이 늘어났다. 아직 회원가입이나 인증하지 않은 접속장치가 핫스팟에 접속하고 인터넷을 하면 핫스팟 제공자의 안내페이지나 로그인 페이지가 뜬다." />
    <meta name="keywords" content="Login,Popup,Captive,Network,UX" />
    <meta name="author" content="Sean Lee" />
<!--Icons-->
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />
    <link rel="alternate" type="application/atom+xml" title="개발새발 &raquo; Feed" href="http://feeds.feedburner.com/github/dogfeet" />
<!--Shims: IE6-8 support of HTML5 elements-->
<!--[if lt IE 9]>
        <script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<!--Styles-->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.0/css/bootstrap-combined.min.css" media="screen, projection" />
    <link rel="stylesheet" href="/css/highlight/github.css" media="screen, projection" />
    <link rel="stylesheet" href="/styles/style.css" media="screen, projection" />
    <link rel="stylesheet" href="/styles/markdown.css" media="screen, projection" />
<!--Scripts-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
    <script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.0/js/bootstrap.min.js"></script>
    <script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
    <script src="/scripts/script.js"></script>
  </head>
  <body>
<!--Topbar-->
    <div class="navbar navbar-static-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar pull-right" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">dogfeet</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li>
                <a href="/site/tagmap.html">Tagmap</a>
              </li>
              <li>
                <a href="/site/archive.html">Archive</a>
              </li>
              <li>
                <a href="/site/atelier.html">Atelier</a>
              </li>
              <li>
                <a href="http://feeds.feedburner.com/github/dogfeet">
                  <img src="http://forum.tattersite.com/ko/style/Textcube/feed-icon.png" />
                </a>
              </li>
            </ul>
            <form id="search-form" class="pull-right navbar-search" action="http://google.com/search" method="get">
              <input type="hidden" name="q" value="site:dogfeet.github.io" />
              <input type="text" name="q" results="0" placeholder="Search" search-query />
            </form>
          </div>
        </div>
      </div>
    </div>
<!--Markup-->
    <div class="container">
      <div>
        <script src="http://platform.twitter.com/widgets.js"></script>
<script>
  //facebook
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

//google plusone
(function() {
  var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
  po.src = 'https://apis.google.com/js/plusone.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();

</script>
<section class="content">
  <article id="post" class="post undefined" typeof="sioc:post" about="/articles/2012/login-popup-captive-network.html" lang="ko-kr">
    <div class="row">
      <div class="span2 muted modern-font small-font">
        <span property="dc:created">
          2012 Feb 27 &raquo;
        </span>
      </div>
      <div class="span10">
        <h1 property="dcterms:title">Login Popup & Captive Network</h1>
      </div>
    </div>
    <div class="row">
      <div class="offset2 span10 modern-font small-font muted">
<span>&nbsp; by <a href="http://kr.linkedin.com/in/seanseonghwanlee">Sean Lee</a></span>
 | <a href="/site/tagmap.html#login" class="tag">Login</a> <a href="/site/tagmap.html#popup" class="tag">Popup</a> <a href="/site/tagmap.html#captive" class="tag">Captive</a> <a href="/site/tagmap.html#network" class="tag">Network</a> <a href="/site/tagmap.html#ux" class="tag">UX</a> | <span><a href="/articles/2012/login-popup-captive-network.html#disqus_thread" data-disqus-identifier="/articles/2012/login-popup-captive-network.html"></a></span>
      </div>
    </div>
    <div class="row">
      <div class="offset2 span10">
<br/>        <style rel="stylesheet" media="screen, projection" scoped="scoped">
          #social-buttons {
  margin-left: 30px;
}
        </style>
        <div id="social-buttons" class="pull-right">
          <ul class="unstyled">
            <li>
              <a class="twitter-share-button" href="https://twitter.com/share" data-url="http://dogfeet.github.io/articles/2012/login-popup-captive-network.html" data-via="lethee" data-count="horizontal" data-lang="en">Tweet</a>
            </li>
            <li>
              <div class="g-plusone" data-size="medium" data-href="http://dogfeet.github.io/articles/2012/login-popup-captive-network.html"></div>
            </li>
            <li>
              <div class="fb-like" data-href="http://dogfeet.github.io/articles/2012/login-popup-captive-network.html" data-send="false" data-layout="button_count" data-show-faces="false"></div>
            </li>
          </ul>
        </div>
        <div property="sioc:content">
          <p>스마트폰이나 노트북을 항상 들고다니는 사람이 늘어남에 따라 모바일AP(즉, 핫스팟)을 이용하는 사람도 많이 늘어났다. 아직 회원가입이나 인증하지 않은 접속장치가 핫스팟에 접속하고 인터넷을 하면 핫스팟 제공자의 안내페이지나 로그인 페이지가 뜬다.</p>

<p><img src="/articles/2012/captive-network/firstwifi.jpg" alt="firstwifi"/></p>

<h2>Captive Network & Problem</h2>

<p>위의 화면은 한국에 가장 많이 사용되는 핫스팟 서비스인 ollehWifi(구, 네스팟)에 접속한 화면이다. 수 많은 호텔이나 큰 규모의 건물 혹은 장소들에서 위와 같은 핫스팟 사용 안내 페이지 혹은 인증 페이지를 볼 수 있다. 이러한 페이지를 Captive Portal이라고 한다.</p>

<p>물론 위에서 ollehWifi 서비스에 가입을 했고 해당 장치가 적절히 인증을 받았다면 위와 같은 화면이 뜨지 않고 바로 원하는 사이트로 이동한다. 인터넷에는 연결했지만, 사용자가 원하는 사이트가 아니라 다른 사이트가 나온다는 점에서 작은 문제가 생긴다.</p>

<p>Wifi를 통해 네트워크에 접속은 되었지만 모바일 어플리케이션이나 웹브라우저가 인터넷에 데이터를 요청하면 실제로 받는 데이터는 원하는 데이터가 아닌 Captive Network의 안내페이지의 데이터를 받아오게 된다. 예를 들어, Captive 네트워크에 스마트폰이 Wifi로 접속해 있다면 http 프로토콜로 JSON 데이터를 요청하는 어플리케이션에서는 html로 된 Captive Portal의 페이지 정보를 받게 될 가능성이 높다. 이러한 데이터 에러를 제대로 처리하지 못하면 어플리케이션에 심각한 문제가 발생할수도 있다.</p>

<h2>Captive Network Detection</h2>

<p>앞서 살펴본 ollehWifi 인증 화면 iOS에 설치된 Captive Network 에 대한 Portal 화면이다. 이 화면은 브라우저를 띄우지 않아도 Captive Network에 접속하게 되면 OS가 자동으로 띄워준다. OS는 이러한 환경을 어떻게 찾아낼 수 있는것일까? </p>

<p><img src="/articles/2012/captive-network/panera-captive.png" alt="panera-captive"/><br/>
<sup><a href="http://www.docstechnotes.com/2011/07/os-x-lion-learns-wi-fi-login-trick-from.html">http://www.docstechnotes.com/2011/07/os-x-lion-learns-wi-fi-login-trick-from.html</a></sup></p>

<p>모바일뿐만 아니라 요즘은 데스크톱 OS에서도 적용되어 있다. iOS의 경우 3.0부터, Mac의 경우 Lion부터, Win의 경우 Win7부터 적용된 것 같다. Lion의 경우 브라우저 말고 이런 팝업창에서 입력한 Captive Network에 대한 사용자ID와 패스워드를 OS 차원에서 저장해주기도 한다.</p>

<p><img src="/articles/2012/captive-network/mac-captive.png" alt="mac-captive"/><br/>
<sup><a href="http://www.apple.com/macosx/whats-new/features.html#networking">http://www.apple.com/macosx/whats-new/features.html#networking</a></sup></p>

<p>Captive Network인지를 확인하기 위해 Lion의 경우 Captive Service가 항상 동작하고 있으며 수시로 네트워크 상황을 확인한다. Captive Network인지 확인하기 위해서 다음과 같은 URL의 데이터를 불러와본다.</p>
<pre><code>$ curl http://www.apple.com/library/test/success.html
<span class="doctype">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"&gt;</span>
<span class="tag">&lt;<span class="title">HTML</span>&gt;</span>
<span class="tag">&lt;<span class="title">HEAD</span>&gt;</span>
    <span class="tag">&lt;<span class="title">TITLE</span>&gt;</span>Success<span class="tag">&lt;/<span class="title">TITLE</span>&gt;</span>
<span class="tag">&lt;/<span class="title">HEAD</span>&gt;</span>
<span class="tag">&lt;<span class="title">BODY</span>&gt;</span>
Success
<span class="tag">&lt;/<span class="title">BODY</span>&gt;</span>
<span class="tag">&lt;/<span class="title">HTML</span>&gt;</span>
</code></pre>
<p><code><a href="http://www.apple.com/library/test/success.html">http://www.apple.com/library/test/success.html</a></code>의 데이터를 불러왔을 때 진짜로 원하는 데이터가 들어있는지 확인하는 <a href="http://erratasec.blogspot.com/2010/09/apples-secret-wispr-request.html">방식</a>이다. 간단하다. Windows또한 비슷한 방식을 사용하며 <a href="http://blog.superuser.com/2011/05/16/windows-7-network-awareness/">NCSI:Network Connectivity Status Indicator</a>라고 부른다.</p>

<h2>적용 및 참고</h2>

<p>어플리케이션이 네트워크를 통해 데이터를 불러와서 사용할 때 확인해야할 것으로 다음과 같은 것이 있다.</p>

<ul>
<li>장치가 네트워크를 사용할 수 있는지</li>
<li>네트워크를 통해 데이터를 불러올 수 있는지</li>
<li>불러온 데이터가 원하는 형식인지</li>
</ul>

<p>Captive Network의 경우 위에서 확인할 사항 중 세 번째 사항에 해당할 것이다. Captive Network에 대하여 알아보려면 다음과 같은 사이트를 더 참고해 볼 수 있다.</p>

<ul>
<li><a href="http://erratasec.blogspot.com/2010/09/apples-secret-wispr-request.html">Apple&rsquo;s secret &ldquo;wispr&rdquo; request</a></li>
<li><a href="http://www.mactalk.com.au/31/66812-iphone-3-0-wireless-captive-portal-support.html">iOS 3.0에서 Captive Network 찾기</a></li>
<li><a href="http://tools.ietf.org/html/draft-nottingham-http-portal-02">Web-based 인증을 위한 표준 제안</a></li>
<li><a href="http://blog.superuser.com/2011/05/16/windows-7-network-awareness/">Windows 7의 NCSI(Network Connectivity Status Indicator)</a></li>
</ul>

<h2>사족</h2>

<p>Captive Network에서 인증을 하지 않으면 원하는 사이트에 접근할 수 없고 접속할 수 있는 포트 또한 제한된다. 인증을 거쳐야만 제대로 사용할 수 있다. 하지만 보통 인증을 위하여 DNS 프로토콜 53번 포트는 열려있는 경우가 있으므로 이를 잘 활용해(SSH 터널링, Proxy) 볼 수도 있을 것이다.</p>

        </div>
      </div>
    </div>
  </article>
</section>
<section id="comments">
  <div class="row">
    <div class="offset2 span10">
      <h3>Feedback</h3>
<div id="disqus_thread" class="well"></div>
<script type="text/javascript">
    var disqus_shortname = 'dogfeet-github';
    var disqus_identifier = 'undefined';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><div class="well">
  <div class="fb-like" data-href="http://dogfeet.github.ioundefined" data-send="true" data-width="450" data-show-faces="true"></div>
  <div class="fb-comments" data-href="http://dogfeet.github.ioundefined" data-num-posts="1"></div>
</div>    </div>
  </div>
</section>

      </div>
      <footer class="footer">
        <p>Copyright &copy; 2008-2013 Dogfeet from coding to pixels</p>
      </footer>
    </div>
<!--DISQUS-->
    <script>
      var disqus_shortname = 'dogfeet-github';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
    </script>
<!--GA-->
    <script>
      if( 'http://dogfeet.github.io' === 'http://' + window.location.hostname ) {
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27493298-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
    </script>
  </body>
</html>
