<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf=8"></meta>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>

  <title>#dogfeet - Docpad</title>
  <meta name="description"
  content="Docpad는 CoffeeScript로 작성한 static page engine이다. 이 dogfeet 사이트는 docpad를 사용해 만들었다."></meta>
  <meta name="keywords"
    content="Docpad,Prettify,Markdown,CoffeeKup"></meta>
  <meta name="author"
    content="Changwoo Park"></meta>

  <link rel="shortcut icon" href="images/favicon.ico"></link>
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png"></link>
  <link rel="apple-touch-icon" sizes="72x72"
    href=" ='images/apple-touch-icon-72x72.png"></link>
  <link rel="apple-touch-icon" sizes="114x114"
    href="images/apple-touch-icon-114x114.png"></link>
  <link rel="alternate" type="application/atom+xml"
    title="Docpad &raquo; Feed"
    href="http://feeds.feedburner.com/github/dogfeet"></link>

  <link rel="stylesheet" media="screen, projection"
    href="/bower_components/bootstrap/dist/css/bootstrap.min.css"></link>
  <link rel="stylesheet" media="screen, projection"
    href="/styles/pygment-github.css"></link>
  <link rel="stylesheet" media="screen, projection"
    href="/styles/style.css"></link>

</head>
<body>
  <nav class="navbar navbar-default navbar-static-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">dogfeet</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/site/archive.html">Archive</a></li>
          <li><a href="/site/keyword-map.html">Keyword Map</a></li>
        </ul>
        <form id="search-form" class="navbar-form navbar-right" action="http://google.com/search" method="get">
          <input type="hidden" name="q" value="site:dogfeet.github.io"></input>
          <input class="form-control" type="text" name="q" results="0" placeholder="Search..."></input>
        </form>
      </div><!--/.nav-collapse -->
    </div>
  </nav>
  <div class="container">
    <div>
      <link rel="stylesheet" media="screen, projection"
  href="/styles/github.css"></link>
<link rel="stylesheet" media="screen, projection"
  href="/styles/markdown.css"></link>

<section class="content">
  <article id="post" class="row post " typeof="sioc:post" about="/articles/2011/docpad.html" lang="ko-kr">
    <div class="col-sm-2 small-font">
      <br /><br />
      <p property="dc:created">2011 Nov 26</p>
      <p class="small-font top-line"> - by<br /><a href="https://pismute.github.io">Changwoo Park</a></p>
      <div id="social-buttons" class="top-line">
        <ul class="unstyled">
          <li><a class="twitter-share-button" href="https://twitter.com/share"
            data-url="http://dogfeet.github.io/articles/2011/docpad.html" data-via="pismute"
            data-count="horizontal" data-lang="en">Tweet</a></li>
          <li><div class="g-plusone" data-size="medium" data-href="http://dogfeet.github.io/articles/2011/docpad.html"></div></li>
          <li><div class="fb-like"
            data-href="http://dogfeet.github.io/articles/2011/docpad.html" data-send="false"
            data-layout="button_count" data-show-faces="false"></div></li>
        </ul>
      </div>

      <p class="small-font top-line"><a href="/site/keyword-map.html#docpad" class="keyword">Docpad</a> <a href="/site/keyword-map.html#prettify" class="keyword">Prettify</a> <a href="/site/keyword-map.html#markdown" class="keyword">Markdown</a> <a href="/site/keyword-map.html#coffeekup" class="keyword">CoffeeKup</a></p>
    </div>

    <div class="col-sm-10">

      <div property="sioc:content"><h1 id="docpad">Docpad</h1>
<p>Docpad는 CoffeeScript로 작성한 static page engine이다. 이 dogfeet 사이트는 docpad를 사용해 만들었다.</p>
<p><img src="/articles/2011/docpad.png" alt="Docpad"></p>
<h2 id="skeleton">Skeleton</h2>
<p>docpad는 일종의 사이트 템플릿을 제공하는데 그걸 skeleton이라고 부른다. docpad에서 만든 skeleton은 다음의 세 개다.</p>
<ul>
<li><a href="https://github.com/balupton/kitchensink.docpad">Kitchensink Skeleton</a> - docpad 2부터 기본 skeleton. bootstrap ui로 된 예제</li>
<li><a href="https://github.com/balupton/canvas.docpad">Canvas Skeleton</a> - 어제 배포된 따끈한 empty skeleton이다.</li>
<li><a href="https://github.com/balupton/balupton.docpad">Balupton Skeleton</a> - docpad 1때의 기본 skeleton balupton님의 blog 소스</li>
</ul>
<h3 id="kitchensink-skeleton">Kitchensink Skeleton</h3>
<p>balupton님이 docpad v2.0를 배포하면서 kitchensink.docpad라는 예제를 배포한다. 이 걸 띄우는 법은 간단하다.</p>
<p>일단 coffee script를 설치하고:</p>
<pre><code>$ npm install -g coffee-script
</code></pre><p>docpad를 설치한다. -g는 global 영역에 설치하는 것으로 -g 옵션을 줘야 명령으로 실행할 수 있다:</p>
<pre><code>$ npm install -g docpad
</code></pre><p><code>kitchensink.docpad</code>를 클론한다:</p>
<p>그리고 해당 디렉토리로 이동하고 나서 <code>docpad run</code>을 실행하고 브라우저로 들어간다. 다른 예제들은 사용법이 같으므로 생략한다.</p>
<h2 id="custom-plugin">Custom Plugin</h2>
<p>Docpad는 blog generator가 아니기 때문에 blog처럼 사용하려면 관련된 기능을 직접 만들어 사용해야 한다.</p>
<p>Plugin에서 require를 통해 underscore나 moment같은 다른 모듈을 사용하는 경우에는 package.json을 꼭 작성해야 한다. package.json의 dependencies 블럭에 의존 모듈을 추가하지 않으면 모듈을 매번 수동으로 설치해야 한다.  package.json이 있으면 docpad는 자동을 모듈을 설치한다.</p>
<h3 id="markdown-prettify-plugin">markdown-prettify Plugin</h3>
<p>markdown에 첨부한 코드가 highlight되도록 plugin을 만들었다. 원래 markdown 규약상 다음과 같이 html로 변환된다:</p>
<pre><code>:::html
&lt;pre&gt;&lt;code&gt;...&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>이 것을 다음과 같이 변환한다:</p>
<pre><code>:::html
&lt;pre class=&quot;prittyprint&quot;&gt;&lt;code&gt;...&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>google prettify는 특별히 언어를 명시하지 않아도 자동으로 찾는다. 완벽하지는 않지만 편리하다.</p>
<p>명시할 수도 있다. 코드 블럭 첫줄에 <code>:::java</code>라고 작성하면 <code>:::java</code>은 없애고 다음과 같이 렌더링한다:</p>
<pre><code>:::html
&lt;pre class=&quot;prittyprint&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;...&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>이 모습 낮설어 보여도 <a href="http://dev.w3.org/html5/spec-author-view/the-code-element.html">w3c 권장사항</a>이다. html5에서 syntax highlight는 이렇게 해야 한다. 지원하는 언어는 <a href="http://google-code-prettify.googlecode.com/svn/trunk/README.html">prettify 페이지</a>에서 확인한다.</p>
<p>&#39;:::&#39;말고 쉘 스크립트들을 위해서 &#39;#!&#39;도 추가했다. <code>#!/usr/bin/env bash</code>을 첫줄로 시작하면 다음과 같이 랜더링한다. 이건 삭제하지 않는다:</p>
<pre><code>:::html
&lt;pre class=&quot;prittyprint&quot;&gt;&lt;code class=&quot;language-bsh&quot;&gt;#!/usr/bin/env bash...&lt;/code&gt;&lt;/pre&gt;
</code></pre><p><code>#!/bin/bash</code>라고 써도 되고 <code>#!/usr/bin/bash</code>라고 써도 된다.</p>
<p>그리고 prettify하지 않은 코드를 위해 &#39;text&#39;와 &#39;plain&#39;도 추가했다. <code>:::text</code>나 <code>:::plain</code>을 첫줄에 넣어주면 다음과 같이 원래대로 렌더링한다.</p>
<pre><code>:::html
&lt;pre&gt;&lt;code&gt;...&lt;/code&gt;&lt;/pre&gt;
</code></pre><h3 id="tool-plugin">Tool Plugin</h3>
<p>기본적으로 Template Engine이기 때문에 다양한 function을 사용할 수 없다. nodejs의 다양한 api들을 template에서 사용하고 싶은 것이다. 나는 CoffeeKup이외의 지식이 빈약하기 때문에 다른 Template Engine에 관한 예제는 올리지 않는다.</p>
<h4 id="-tool-moment-"><code>@tool.moment</code></h4>
<p>CoffeeKup의 경우에 Tempate Data에 함수를 담아 넘기고 그 함수를 사용할 수 있다. Plugin으로 Template Data에 momentjs를 넘기고 그 것을 사용하는 예제를 보자.</p>
<p>다음은 ToolPlugin 소스다. 나는 docpad Plugin이 아닌 docpad site plugin으로 넣었다. 기본적으로 DocpadPlugin 클래스를 상속받아 사용한다는 점에서 구조는 똑같다. 다만 위치가 docpad site/plugins/ 밑에 들어가는 것만 다르다.</p>
<pre><code># Requires
DocpadPlugin = require &#39;docpad/lib/plugin.coffee&#39;
moment = require &#39;moment&#39;

# Define Plugin
class ToolPlugin extends DocpadPlugin
  # Plugin Name
  name: &#39;totaldocuments&#39;

  # Ammend our Template Data
  renderBefore: ({documents, templateData}, next) -&gt;
    templateData[ &#39;tool&#39; ] = tool =
      moment: moment

    # Continue onto the next plugin
    next()

# Export Plugin
module.exports = ToolPlugin
</code></pre><p>Template 페이지에서 이 것을 이용한 소스를 만들면 다음과 같다.</p>
<pre><code>dateWrapper = @tool.moment document.date
dateWrapper.format &#39;MMM DD&#39; #ex) JAN 01
</code></pre><h4 id="-tool-summary-"><code>@tool.summary</code></h4>
<p>index 페이지에서는 글들의 summary만 보여주고 싶었다. docpad는 부가기능이 별로 없기 때문에 고민이 좀 됐는데 의외로 간단히 해결했다.</p>
<p>summary부터 정의해보자. 이 걸 생각해내는데 오래걸렸다. 좋은 아이디어가 없었는데 의외로 가까운데 있었다. 각 글의 첫 heading tag(/h[123456]/)까지가 summary로 사용된다. 그러니까 글을 쓸때 첫 heading tag가 summary이고 heading tag가 아예 존재하지 않으면 문서 전체를 summary로 사용한다:</p>
<pre><code>:::markdown

Here is summary

## My heading
</code></pre><p>index 페이지에서 summary를 추출한다. 다음 예제는 CoffeeKup이다:</p>
<pre><code>:::coffee
@tool.summary document.contentRendered
</code></pre><p>html을 잘라내는 것이기 때문에 content가 아니라 contentRendered 값을 가져다 사용해야 한다.</p>
<h3 id="authors-plugin">authors Plugin</h3>
<p>authors Plugin인 저자를 소개하는 페이지를 만들고 다른 문서의 author 프로퍼티에 저자 이름을 명시하면 자동으로 그 페이지로 링크해주는 것이다. <code>/src/documents/authors/</code>안에 소개 페이지를 다음과 같이 만든다.</p>
<pre><code>--- yaml
name= &#39;ahmooge&#39;
---

blahblah
</code></pre><p>docpad는 이 문서를 처리해서 <code>{name:&#39;ahmooge&#39;, url:&#39;/authors/ahmooge.html&#39;, content: &#39;blahblah..&#39;, contentRendered: &#39;&lt;span&gt;blahblah&lt;/span&gt;&#39;}</code>라는 객체로 만든다. 이 객체를 document 객체라고 하자(실제 코드에서도 document다). authors plugin은 <code>/src/documents/authors/</code>안에 잇는 파일을 모아서 template data의 <code>@authors.data</code> 객체에 담아준다. &#39;Kim&#39;라는 document1와 &#39;Park&#39;라는 document2가 있으면 <code>@authors.data</code>에는 <code>{&quot;Kim&quot;: document1, &quot;Park&quot;:document2}</code>라는 객체가 들어가게 된다.</p>
<p>그럼 CoffeeKup template에서 사용해보자:</p>
<pre><code> a href: @authors.data[ @document.author ].url
</code></pre><p>예외처리는 생략함.</p>
<p>CoffeeKup은 <code>with</code> 구문을 이용해서 scope variable을 확장할 수 있는 파라미터 locals와 hardcoded를 지원하지만 아직 docpad는 지원하지 않기 때문에 template data scope을 이용했다.</p>
<h2 id="troubleshooting">TroubleShooting</h2>
<h3 id="enoent">ENOENT</h3>
<p>docpad를 실행했는데 다음과 같은 에러가 발생하면:</p>
<pre><code>Error: Command failed: npm ERR! error installing coffee-script@1.1.3 Error: ENOENT, no such file or directory &#39;/Users/pismute/dogfeet/dogfeet.github.io/node_modules/coffee-script/package.json&#39;
</code></pre><p>수동으로 패키지를 설치한다. 원래 docpad는 자동으로 설치하고 update해줄 수 있다고 하는데 뭔가 잘 안될 때가 있다:</p>
<pre><code>npm install docpad
npm install coffee-script
</code></pre><p>이미 docpad랑 coffee-script 설치한 것 같은데 왜 또 설치해야하지? 라는 생각이 들 수 있다. 이유는 먼저 설치한 것은 npm global 영역에 설치한 것이고 이것은 local에서 설치하는 것이다. global 영역에 설치해야 command로 실행할 수 있다.</p>
<p>global 영역에서 설치한 버전을 local에서 사용하게 할 수도 있다. <code>npm link</code> 명령어를 살펴봐라.</p>
<p>npm은 블로그를 이전하고 나서 파볼 계획이다.</p>
</div>
    </div>
  </article>
</section>

<div id="fb-root"></div>
<script src="//connect.facebook.net/en_US/all.js#xfbml=1"></script>
<script src="http://platform.twitter.com/widgets.js"></script>
<script src="https://apis.google.com/js/plusone.js"></script>

    </div>
    <footer class="footer"><p>Copyright &copy; 2008+ Dogfeet from coding to pixels</p></footer>
  </div>

  <script src="/bower_components/jquery/dist/jquery.js"></script>
  <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/scripts/script.js"></script>

  <script>
    if( 'http://dogfeet.github.io/' === 'http://' + window.location.hostname ) {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-27493298-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    }
  </script>
</body>
</html>
